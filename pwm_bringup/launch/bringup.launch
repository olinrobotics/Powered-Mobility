<launch>
    <!-- TODO : add sim-compatible configuration -->
    <arg name="all"          default="true"/>

    <arg name="arbiter"       default="$(arg all)"/>
    <arg name="transform"     default="$(arg all)"/>
	<arg name="hardware"      default="$(arg all)"/>
    <arg name="arduino"       default="$(arg all)"/>
	<arg name="localization"  default="$(arg all)"/>
    <arg name="serial_driver" default="$(arg all)"/>
	<arg name="navigation"    default="$(arg all)"/>
	<arg name="indoor"        default="$(arg all)"/>

    <!-- Arbitration -->
    <group if="$(arg arbiter)">
        <node pkg="topic_tools" type="mux" name="cmd_vel_mux" args="cmd_vel manual_cmd_vel auto_cmd_vel estop_cmd_vel mux:=mux_cmd_vel"/>
        <node pkg="pwm_dev" type="select_mode.py" name="select_mode"/>
    </group>

    <!-- Static TF / Viz -->
    <group if="$(arg transform)">
        <include file="$(find pwm_description)/launch/urdf.launch"/>
        <node pkg="robot_state_publisher" type="robot_state_publisher" name="robot_state_publisher"/>
        <node pkg="joint_state_publisher" type="joint_state_publisher" name="joint_state_publisher"/>
    </group>

    <!-- Hardware -->
    <include file="$(find pwm_bringup)/launch/sensors.launch">
        <arg name="hardware" value="$(arg hardware)"/>
    </include>

	<group if="$(arg hardware)">
		<include file="$(find pwm_bringup)/launch/joy.launch"/>
		<include file="$(find pwm_arduino)/launch/arduino.launch" if="$(arg arduino)"/>
        <include file="$(find pwm_driver)/launch/serial_server.launch" if="$(arg serial_driver)"/>
	</group>

    <!-- Localization -->
    <group if="$(arg localization)">
        <include file="$(find pwm_localization)/launch/localization.launch" if="$(arg localization)">
			<arg name="indoor" value="$(arg indoor)"/>
		</include>
    </group>

    <!-- Navigation -->
    <group if="$(arg navigation)">
		<node pkg="pwm_dev" type="grass_detector" name="grass_detector"/>
        <include file="$(find pwm_navigation)/launch/move_base.launch" if="$(arg navigation)"/>
    </group>

</launch>
